_G["xPlayer"],_G["source"],_G["developer"]={},GetPlayerServerId(PlayerId()),function()end;local a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s,t=AddTextEntry,BeginTextCommandDisplayHelp,EndTextCommandDisplayHelp,SetNotificationTextEntry,AddTextComponentSubstringPlayerName,DrawNotification,GetEntityCoords,World3dToScreen2d,SetTextScale,SetTextFont,SetTextEntry,SetTextCentre,AddTextComponentString,DrawText,DoesEntityExist,GetDistanceBetweenCoords,GetPlayerPed,TriggerEvent,TriggerServerEvent;local u=GetCurrentResourceName()local v={["ESC"]=322,["F1"]=288,["F2"]=289,["F3"]=170,["F5"]=166,["F6"]=167,["F7"]=168,["F8"]=169,["F9"]=56,["F10"]=57,["~"]=243,["1"]=157,["2"]=158,["3"]=160,["4"]=164,["5"]=165,["6"]=159,["7"]=161,["8"]=162,["9"]=163,["-"]=84,["="]=83,["BACKSPACE"]=177,["TAB"]=37,["Q"]=44,["W"]=32,["E"]=38,["R"]=45,["T"]=245,["Y"]=246,["U"]=303,["P"]=199,["["]=39,["]"]=40,["ENTER"]=18,["CAPS"]=137,["A"]=34,["S"]=8,["D"]=9,["F"]=23,["G"]=47,["H"]=74,["K"]=311,["L"]=182,["LEFTSHIFT"]=21,["Z"]=20,["X"]=73,["C"]=26,["V"]=0,["B"]=29,["N"]=249,["M"]=244,[","]=82,["."]=81,["LEFTCTRL"]=36,["LEFTALT"]=19,["SPACE"]=22,["RIGHTCTRL"]=70,["HOME"]=213,["PAGEUP"]=10,["PAGEDOWN"]=11,["DELETE"]=178,["LEFT"]=174,["RIGHT"]=175,["TOP"]=27,["DOWN"]=173,["NENTER"]=201,["N4"]=108,["N5"]=60,["N6"]=107,["N+"]=96,["N-"]=97,["N7"]=117,["N8"]=61,["N9"]=118}DevModeStatus=false;UtilityLibLoaded=true;local w={Cache={PlayerPedId=PlayerPedId(),Marker={},Object={},Dialogue={},Blips={},N3d={},Events={},Guards={},Scenes={},SetData={},Frozen={},FlowDetector={},Textures={},Settings={},EntityStack={},Loop={},SliceGroups={}}}UtilityNet={}Citizen.CreateThreadNow(function()if UFAPI then if u=="utility_lib"then _G["Utility"]=w else _G["UtilityLibrary"]=w end else _G["Utility"]=w end end)UseDelete=function(x)w.Cache.Settings.UseDelete=x end;On=function(type,y,z)RegisterNetEvent("Utility:On:"..(z and"!"or"")..type)local A=AddEventHandler("Utility:On:"..(z and"!"or"")..type,y)table.insert(w.Cache.Events,A)return A end;_G.old_TaskVehicleDriveToCoord=TaskVehicleDriveToCoord;TaskVehicleDriveToCoord=function(ped,B,C,D,E)old_TaskVehicleDriveToCoord(ped,B,C,D or 10.0,0,GetEntityModel(B),2883621,E or 1.0)end;_G.old_DisableControlAction=DisableControlAction;DisableControlAction=function(F,G,H)H=H~=nil and H or true;if v[string.upper(F)]then return old_DisableControlAction(0,v[string.upper(F)],G)else return old_DisableControlAction(F,G,H)end end;DisableControlForSeconds=function(G,I)local J=I;Citizen.CreateThread(function()while J>0 do Citizen.Wait(1000)J=J-1 end;return end)Citizen.CreateThread(function()while J>0 do DisableControlAction(v[string.upper(G)])Citizen.Wait(1)end;return end)end;_G.old_IsControlJustPressed=IsControlJustPressed;IsControlJustPressed=function(K,L,M)if type(K)=="number"then local N=K;local G=L;return old_IsControlJustPressed(N,G)end;developer("^2Created^0","key map",K)local O="keyboard"K=K:lower()if K:find("mouse_")or K:find("iom_wheel")then O="mouse_button"elseif K:find("_index")then O="pad_digitalbutton"elseif K:find("iom_axis")then O="pad_axis"end;RegisterKeyMapping('utility '..u..' '..K,M or'',O,K)local P=nil;Citizen.CreateThread(function()Citizen.Wait(500)P=RegisterNetEvent("Utility:Pressed_"..u.."_"..K,L)table.insert(w.Cache.Events,P)end)end;ShowNotification=function(Q)d('STRING')e(Q)f(false,true)end;ButtonNotification=function(Q)if string.match(Q,"{.*}")then Q=string.multigsub(Q,{"{A}","{B}","{C}","{D}","{E}","{F}","{G}","{H}","{L}","{M}","{N}","{O}","{P}","{Q}","{R}","{S}","{T}","{U}","{V}","{W}","{X}","{Y}","{Z}"},{"~INPUT_VEH_FLY_YAW_LEFT~","~INPUT_SPECIAL_ABILITY_SECONDARY~","~INPUT_LOOK_BEHIND~","~INPUT_MOVE_LR~","~INPUT_CONTEXT~","~INPUT_ARREST~","~INPUT_DETONATE~","~INPUT_VEH_ROOF~","~INPUT_CELLPHONE_CAMERA_FOCUS_LOCK~","~INPUT_INTERACTION_MENU~","~INPUT_REPLAY_ENDPOINT~","~INPUT_FRONTEND_PAUSE~","~INPUT_FRONTEND_LB~","~INPUT_RELOAD~","~INPUT_MOVE_DOWN_ONLY~","~INPUT_MP_TEXT_CHAT_ALL~","~INPUT_REPLAY_SCREENSHOT~","~INPUT_NEXT_CAMERA~","~INPUT_MOVE_UP_ONLY~","~INPUT_VEH_HOTWIRE_LEFT~","~INPUT_VEH_DUCK~","~INPUT_MP_TEXT_CHAT_TEAM~","~INPUT_HUD_SPECIAL~"})end;a('ButtonNotification'..string.len(Q),Q)b('ButtonNotification'..string.len(Q))c(0,false,true,-1)end;ButtonFor=function(Q,R)local S=GetGameTimer()Citizen.CreateThread(function()while GetGameTimer()-S<(R or 5000)do ButtonNotification(Q)Citizen.Wait(1)end end)end;FloatingNotification=function(Q,T)a('FloatingNotification',Q)SetFloatingHelpTextWorldPosition(1,T)SetFloatingHelpTextStyle(1,1,2,-1,3,0)b('FloatingNotification')c(2,false,false,-1)end;MakeEntityFaceEntity=function(U,V,W)local X=g(U,true)local Y=g(V,true)if W then local Z=GetHeadingFromVector_2d(Y.x-X.x,Y.y-X.y)SetEntityHeading(U,Z)else local Z=GetHeadingFromVector_2d(X.x-Y.x,X.y-Y.y)SetEntityHeading(V,Z)end end;DrawText3Ds=function(T,_,a0,a1,a2)if T then local a3,a4,a5=h(T.x,T.y,T.z)if a3 then i(a0 or 0.35,a0 or 0.35)j(a1 or 4)k("STRING")l(1)m(_)o(a4,a5)if a2 then local a6=string.len(_)/370;local a7,a8=string.gsub(a6,"\n","\n")*0.025;if a8==nil then a8=0 end;DrawRect(a4,a5+0.0125,0.025+a6,0.025+a8,0,0,0,90)end end end end;_G.old_TaskPlayAnim=TaskPlayAnim;TaskPlayAnim=function(ped,a9,...)if not HasAnimDictLoaded(a9)then RequestAnimDict(a9)while not HasAnimDictLoaded(a9)do Citizen.Wait(1)end end;old_TaskPlayAnim(ped,a9,...)RemoveAnimDict(a9)end;TaskEasyPlayAnim=function(aa,ab,ac,ad)if ac==nil then ac=51 end;if ad==nil then ad=-1 end;TaskPlayAnim(PlayerPedId(),aa,ab,2.0,2.0,ad,ac,0)if ad>-1 or ad>0 then Citizen.Wait(ad)end end;_G.old_CreateObject=CreateObject;CreateObject=function(ae,...)local af=ae;if type(ae)=="string"then af=GetHashKey(ae)end;if not IsModelValid(af)then error("Model \""..ae.."\" loaded from \""..GetCurrentResourceName().."\" is not valid^0")return end;if not HasModelLoaded(af)then RequestModel(af)while not HasModelLoaded(af)do Citizen.Wait(1)end end;local ag=old_CreateObject(af,...)if w.Cache.Settings.UseDelete then table.insert(w.Cache.EntityStack,ag)end;SetModelAsNoLongerNeeded(af)local ah=0;if NetworkGetEntityIsNetworked(ag)then ah=ObjToNet(ag)SetNetworkIdExistsOnAllMachines(ah,true)SetNetworkIdCanMigrate(ah,true)end;return ag,ah end;_G.old_CreatePed=CreatePed;CreatePed=function(af,...)if type(af)=="string"then af=GetHashKey(af)end;if not HasModelLoaded(af)then RequestModel(af)while not HasModelLoaded(af)do Citizen.Wait(1)end end;local ped=old_CreatePed(0,af,...)SetModelAsNoLongerNeeded(af)local ah=0;if NetworkGetEntityIsNetworked(ped)then ah=PedToNet(ped)SetNetworkIdExistsOnAllMachines(ah,true)SetNetworkIdCanMigrate(ah,true)end;return ped,ah end;SetPedStatic=function(ai,aj)FreezeEntityPosition(ai,aj)SetEntityInvincible(ai,aj)SetBlockingOfNonTemporaryEvents(ai,aj)end;_G.old_CreateVehicle=CreateVehicle;CreateVehicle=function(af,...)if type(af)=="string"then af=GetHashKey(af)end;if not HasModelLoaded(af)then RequestModel(af)while not HasModelLoaded(af)do Citizen.Wait(1)end end;local ak=old_CreateVehicle(af,...)SetModelAsNoLongerNeeded(af)local ah=0;if NetworkGetEntityIsNetworked(ak)then ah=VehToNet(ak)SetNetworkIdExistsOnAllMachines(ah,true)SetNetworkIdCanMigrate(ah,true)end;return ak,ah end;_G.old_DeleteEntity=DeleteEntity;DeleteEntity=function(ai,al)if not al then NetworkRequestControlOfEntity(ai)while not NetworkRequestControlOfEntity(ai)do Citizen.Wait(1)end;if not IsEntityAMissionEntity(ai)then SetEntityAsMissionEntity(ai)end;old_DeleteEntity(ai)else NetworkRequestControlOfNetworkId(ai)local am=NetworkGetEntityFromNetworkId(ai)while not NetworkRequestControlOfEntity(am)do Citizen.Wait(1)end;SetEntityAsMissionEntity(am)old_DeleteEntity(am)end end;_G.old_GetPlayerName=GetPlayerName;GetPlayerName=function(an)return old_GetPlayerName(an or PlayerId())end;_G.old_PlayerPedId=PlayerPedId;PlayerPedId=function()if not p(w.Cache.PlayerPedId)then w.Cache.PlayerPedId=old_PlayerPedId()end;return w.Cache.PlayerPedId end;StopLoop=function(an)w.Cache.Loop[an].status=false end;CreateLoop=function(L,ao,ap)local aq=RandomId(5)w.Cache.Loop[aq]={status=true,func=L,tick=ao}if ap~=false then Citizen.CreateThread(function()while w.Cache.Loop[aq]and w.Cache.Loop[aq].status do L(aq)Citizen.Wait(ao or 1)end end)end;return aq end;PauseLoop=function(aq,ar)Citizen.SetTimeout(ar or 0,function()print("Pausing loop "..aq)w.Cache.Loop[aq].status=false end)end;ResumeLoop=function(aq,ar)local as=w.Cache.Loop[aq]Citizen.SetTimeout(ar or 0,function()print("Resuming loop "..aq)as.status=true;Citizen.CreateThread(function()while as and as.status do as.func(aq)Citizen.Wait(as.tick or 1)end end)end)end;GetWorldClosestPed=function(at)local au=0;local av=GetGamePool("CPed")local T=g(PlayerPedId())local aw=at+5.0;for ax=1,#av do local ay=q(T,g(av[ax]),false)if ay<=at and av[ax]~=PlayerPedId()then if aw>ay then aw=ay;au=av[ax]end end end;return au,av end;GetWorldClosestPlayer=function(at)local au=0;local az={}local aw=at+5.0;local av=GetGamePool("CPed")local T=g(PlayerPedId())for ax=1,#av do if IsPedAPlayer(av[ax])then table.insert(az,NetworkGetPlayerIndexFromPed(av[ax]))local ay=q(T,g(av[ax]),false)if ay<=at and av[ax]~=PlayerPedId()then if aw>ay then aw=ay;au=NetworkGetPlayerIndexFromPed(av[ax])end end end end;return au,az end;GetEntitySurfaceMaterial=function(ai)local T=GetEntityCoords(ai)local aA=StartShapeTestCapsule(T.x,T.y,T.z,T.x,T.y,T.z-2.5,2,1,ai,7)local a7,aB,a7,a7,aC=GetShapeTestResultIncludingMaterial(aA)return aC,aB end;GetLoadoutOfPed=function(ped)local aD=ESX.GetWeaponList()local aE={}for ax=1,#aD,1 do local hash=GetHashKey(aD.name)if HasPedGotWeapon(ped,hash,false)then table.insert(aE,{name=aD.name,hash=hash,ammo=GetAmmoInPedWeapon(ped,hash)})end end;return aE end;local aF=FreezeEntityPosition;FreezeEntityPosition=function(ai,aj)w.Cache.Frozen[ai]=aj;aF(ai,aj)end;IsEntityFrozen=function(ai)return w.Cache.Frozen[ai]==true end;GetNearestValue=function(aG,aH)local aI=100*100000000000;local aJ=0;for ax=1,#aH do local aK=math.abs(aH[ax]-aG)if aK<aI then aI=aK;n=aH[ax]aJ=ax end end;return n,aI,aJ end;StartESX=function(aL,aM)Citizen.CreateThreadNow(function()ESX=exports["es_extended"]:getSharedObject()while ESX.GetPlayerData().job==nil do Citizen.Wait(1)end;uPlayer=ESX.GetPlayerData()xPlayer=uPlayer;if aM~=nil then while ESX.GetPlayerData()[aM]==nil do Citizen.Wait(1)end;uPlayer=ESX.GetPlayerData()xPlayer=uPlayer end;if aM~=nil then RegisterNetEvent('esx:set'..string.upper(aM:sub(1,1))..aM:sub(2),function(aN)uPlayer[aM]=aN;xPlayer=uPlayer end)end;RegisterNetEvent('esx:setJob',function(aN)uPlayer.job=aN;xPlayer=uPlayer;if OnJobUpdate then OnJobUpdate()end end)end)end;StartQB=function()QBCore=exports['qb-core']:GetCoreObject()uPlayer=QBCore.Functions.GetPlayerData()Player=uPlayer;RegisterNetEvent('QBCore:Client:OnPlayerLoaded',function()uPlayer=QBCore.Functions.GetPlayerData()Player=uPlayer end)RegisterNetEvent('QBCore:Client:OnJobUpdate',function(aO)uPlayer.job=aO;Player=uPlayer;if OnJobUpdate then OnJobUpdate()end end)end;StartFramework=function()if GetResourceState("qb-core")~="missing"then StartQB()return true elseif GetResourceState("es_extended")~="missing"then StartESX()return true end end;GetDataForJob=function(aN)local aP=promise:new()if GetResourceState("es_extended")=="started"then ESX.TriggerServerCallback("Utility:GetJobData",function(aQ)aP:resolve(aQ)end,aN)elseif GetResourceState("qb-core")=="started"then QBCore.Functions.TriggerCallback("Utility:GetJobData",function(aQ)aP:resolve(aQ)end,aN)end;aP=Citizen.Await(aP)return#aP,aP end;local aR=0;GetOnHandObject=function()return aR end;TakeObjectOnHand=function(ped,aS,aT,aU,aV,aW,aX,aY,aZ)developer("^2Taking^0","object",aS.." ("..GetEntityModel(aS)..")")if type(aS)=="number"then NetworkRequestControlOfEntity(aS)while not NetworkHasControlOfEntity(aS)do Citizen.Wait(1)end;TaskPlayAnim(ped,"anim@heists@box_carry@","idle",3.0,3.0,-1,63,0,0,0,0)Citizen.Wait(100)AttachEntityToEntity(aS,ped,GetPedBoneIndex(ped,60309),aU or 0.2,aV or 0.08,aW or 0.2,aX or-45.0,aY or 290.0,aZ or 0.0,true,true,false,true,1,true)aR=aS elseif type(aS)=="string"then local T=g(ped)local a_=CreateObject(aS,T+vector3(0.0,0.0,aT or 0.2),true,false,false)SetEntityAsMissionEntity(a_)TaskPlayAnim(ped,"anim@heists@box_carry@","idle",3.0,-8,-1,63,0,0,0,0)Citizen.Wait(100)AttachEntityToEntity(a_,ped,GetPedBoneIndex(ped,60309),aU or 0.2,aV or 0.08,aW or 0.2,aX or-45.0,aY or 290.0,aZ or 0.0,true,true,false,true,1,true)aR=a_;return a_ end end;DropObjectFromHand=function(b0,b1)if b1 then developer("^1Deleting^0","from hand",b0)DeleteEntity(b0)else developer("^3Dont delete^0","from hand",b0)DetachEntity(b0)SetEntityCoords(b0,GetOffsetFromEntityInWorldCoords(b0,0,0.5,0))PlaceObjectOnGroundProperly(b0)FreezeEntityPosition(b0,true)end;ClearPedTasks(PlayerPedId())aR=0 end;IsInRadius=function(X,Y,at,b2)local ay=#(X-Y)if b2 then DrawSphere(Y,at,255,0,0,0.5)end;return ay<at end;IsNearCoords=function(T,at,b2)local ay=#(GetEntityCoords(PlayerPedId())-T)if b2 then DrawSphere(T,at,255,0,0,0.5)end;return ay<at end;GenerateRandomCoords=function(T,at,Z)local b3=T.x+math.random(-at,at)local b4=T.y+math.random(-at,at)local a7,b5=GetGroundZFor_3dCoord(b3,b4,200.0,0)if Z then return vector3(b3,b4,b5),math.random(0.0,360.0)end;return vector3(b3,b4,b5)end;SetFor=function(an,b6,b7)if w.Cache["SetData"][an]==nil then w.Cache["SetData"][an]={}end;if type(b6)=="table"then for b8,aG in pairs(b6)do if type(aG)=="function"then developer("^2Setting^0","data","("..an..") ["..b8 .." = "..tostring(aG).."] {table}")else developer("^2Setting^0","data","("..an..") ["..b8 .." = "..json.encode(aG).."] {table}")end;w.Cache["SetData"][an][b8]=aG end else if type(b7)=="function"then developer("^2Setting^0","data","("..an..") ["..b6 .." = "..tostring(b7).."] {single}")else developer("^2Setting^0","data","("..an..") ["..b6 .." = "..json.encode(b7).."] {single}")end;w.Cache["SetData"][an][b6]=b7 end end;GetFrom=function(an,b6)if b6==nil then b6="not defined"end;developer("^3Getting^0","data","("..an..") ["..b6 .."]")if w.Cache["SetData"][an]~=nil then if b6=="not defined"then return w.Cache["SetData"][an]else return w.Cache["SetData"][an][b6]end else return nil end end;function GetSliceCoordsFromCoords(b9)return vector2(math.floor((b9.x+8192)/100),math.floor((b9.y+8192)/100))end;function GetSliceFromCoords(ba)local bb=GetSliceCoordsFromCoords(ba)local an=bb.x*4+bb.y;return an end;function GetEntitySlice(ped)return GetSliceFromCoords(GetEntityCoords(ped))end;function GetPlayerSlice(bc)local ped=GetPlayerPed(bc)return GetSliceFromCoords(GetEntityCoords(ped))end;function GetSelfSlice()local ped=PlayerPedId()return GetSliceFromCoords(GetEntityCoords(ped))end;function IsOnScreen(T)local a3,a4,a5=World3dToScreen2d(T.x,T.y,T.z)return a3 end;function SliceUsed(bb)return w.Cache.SliceGroups[bb]or false end;function SetSliceUsed(bb,b7)w.Cache.SliceGroups[bb]=b7 end;RandomId=function(bd)bd=bd or 5;local be=""for ax=1,bd do be=be.."9"end;return math.random(0,be)end;CreateMarker=function(an,T,bf,bg,bh)if DoesExist("m",an)then Citizen.Wait(100)return else if type(T)~="vector3"then developer("^1Error^0","You can use only vector3 for coords!",an)return end;an=string.gsub(an,"{r}",RandomId())developer("^2Created^0","Marker",an)local bi={render_distance=bf,interaction_distance=bg,coords=T,slice=bh and bh.slice=="ignore"and-1 or tostring(GetSliceFromCoords(T))}if type(bh)=="table"then if bh.rgb~=nil then bi.type=1;bi.rgb=bh.rgb elseif bh.text~=nil then bi.type=0;bi.text=bh.text else bi.type=1;bi.rgb={bh[1],bh[2],bh[3]}end;if bh.type~=nil and type(bh.type)=="number"then bi._type=bh.type end;if bh.direction~=nil and type(bh.direction)=="vector3"then bi._direction=bh.direction end;if bh.rotation~=nil and type(bh.rotation)=="vector3"then bi._rot=bh.rotation end;if bh.scale~=nil and type(bh.scale)=="vector3"then bi._scale=bh.scale end;if bh.alpha~=nil and type(bh.alpha)=="number"then bi.alpha=bh.alpha end;if bh.animation~=nil and type(bh.animation)=="boolean"then bi.anim=bh.animation end;if bh.job~=nil then bi.job=bh.job end;if bh.notify~=nil then local bj=string.multigsub(bh.notify,{"{A}","{B}","{C}","{D}","{E}","{F}","{G}","{H}","{L}","{M}","{N}","{O}","{P}","{Q}","{R}","{S}","{T}","{U}","{V}","{W}","{X}","{Y}","{Z}"},{"~INPUT_VEH_FLY_YAW_LEFT~","~INPUT_SPECIAL_ABILITY_SECONDARY~","~INPUT_LOOK_BEHIND~","~INPUT_MOVE_LR~","~INPUT_CONTEXT~","~INPUT_ARREST~","~INPUT_DETONATE~","~INPUT_VEH_ROOF~","~INPUT_CELLPHONE_CAMERA_FOCUS_LOCK~","~INPUT_INTERACTION_MENU~","~INPUT_REPLAY_ENDPOINT~","~INPUT_FRONTEND_PAUSE~","~INPUT_FRONTEND_LB~","~INPUT_RELOAD~","~INPUT_MOVE_DOWN_ONLY~","~INPUT_MP_TEXT_CHAT_ALL~","~INPUT_REPLAY_SCREENSHOT~","~INPUT_NEXT_CAMERA~","~INPUT_MOVE_UP_ONLY~","~INPUT_VEH_HOTWIRE_LEFT~","~INPUT_VEH_DUCK~","~INPUT_MP_TEXT_CHAT_TEAM~","~INPUT_HUD_SPECIAL~"})bi.notify=bj end elseif type(bh)=="string"then bi.type=0;bi.text=bh end;w.Cache.Marker[an]=bi;s("Utility:Create","Marker",an,bi)end end;SetMarker=function(an,bk,K,b7)if type(b7)~=bk and b7~=nil then developer("^1Error^0",K.." can be only a "..bk,"[Marker]")return end;if DoesExist("marker",an)then w.Cache.Marker[an][K]=b7;s("Utility:Edit","Marker",an,K,b7)else developer("^1Error^0","Unable to edit the marker as it does not exist",an)end end;SetMarkerType=function(an,bk)SetMarker(an,"number","_type",bk)end;SetMarkerDirection=function(an,bl)SetMarker(an,"vector3","_direction",bl)end;SetMarkerRotation=function(an,bm)SetMarker(an,"vector3","_rot",bm)end;SetMarkerScale=function(an,a0)SetMarker(an,"vector3","_scale",a0)end;SetMarkerColor=function(an,bn)SetMarker(an,"table","rgb",bn)end;SetMarkerCoords=function(an,T)SetMarker(an,"string","slice",tostring(GetSliceFromCoords(T)))SetMarker(an,"vector3","coords",T)end;SetMarkerRenderDistance=function(an,bf)SetMarker(an,"number","render_distance",bf)end;SetMarkerInteractionDistance=function(an,bg)SetMarker(an,"number","interaction_distance",bg)end;SetMarkerAlpha=function(an,bo)SetMarker(an,"number","alpha",bo)end;SetMarkerAnimation=function(an,aj)SetMarker(an,"boolean","anim",aj)end;SetMarkerDrawOnEntity=function(an,aj)SetMarker(an,"boolean","draw_entity",aj)end;SetMarkerNotify=function(an,_)if type(_)=="string"then _=string.multigsub(_,{"{A}","{B}","{C}","{D}","{E}","{F}","{G}","{H}","{L}","{M}","{N}","{O}","{P}","{Q}","{R}","{S}","{T}","{U}","{V}","{W}","{X}","{Y}","{Z}"},{"~INPUT_VEH_FLY_YAW_LEFT~","~INPUT_SPECIAL_ABILITY_SECONDARY~","~INPUT_LOOK_BEHIND~","~INPUT_MOVE_LR~","~INPUT_PICKUP~","~INPUT_ARREST~","~INPUT_DETONATE~","~INPUT_VEH_ROOF~","~INPUT_CELLPHONE_CAMERA_FOCUS_LOCK~","~INPUT_INTERACTION_MENU~","~INPUT_REPLAY_ENDPOINT~","~INPUT_FRONTEND_PAUSE~","~INPUT_FRONTEND_LB~","~INPUT_RELOAD~","~INPUT_MOVE_DOWN_ONLY~","~INPUT_MP_TEXT_CHAT_ALL~","~INPUT_REPLAY_SCREENSHOT~","~INPUT_NEXT_CAMERA~","~INPUT_MOVE_UP_ONLY~","~INPUT_VEH_HOTWIRE_LEFT~","~INPUT_VEH_DUCK~","~INPUT_MP_TEXT_CHAT_TEAM~","~INPUT_HUD_SPECIAL~"})end;SetMarker(an,"string","notify",_)end;Set3dText=function(an,_)SetMarker(an,"string","text",_)end;Set3dTextScale=function(an,a0)SetMarker(an,"number","_scale",a0)end;Set3dTextDrawRect=function(an,aj)SetMarker(an,"boolean","rect",aj)end;Set3dTextFont=function(an,a1)SetMarker(an,"number","font",a1)end;DeleteMarker=function(an)if not DoesExist("m",an)then Citizen.Wait(100)return else developer("^1Deleted^0","Marker",an)w.Cache.Marker[an]=nil;s("Utility:Remove","Marker",an)ClearAllHelpMessages()end end;CreateiObject=function(an,ae,ba,Z,bg,bp,aN)developer("^2Created^0 Object "..an.." ("..ae..")")local ag;if bp~=nil then ag=CreateObject(GetHashKey(ae),ba.x,ba.y,ba.z,bp,false,false)or nil else ag=CreateObject(GetHashKey(ae),ba.x,ba.y,ba.z,true,false,false)or nil end;SetEntityHeading(ag,Z)SetEntityAsMissionEntity(ag,true,true)FreezeEntityPosition(ag,true)SetModelAsNoLongerNeeded(hash)_object={obj=ag,coords=ba,interaction_distance=bg or 3.0,slice=tostring(GetSliceFromCoords(ba)),job=aN}w.Cache.Object[an]=_object;s("Utility:Create","Object",an,_object)return ag,g(ag)end;DeleteiObject=function(an,b1)developer("^1Deleted^0","Object",an)if b1 then DeleteEntity(w.Cache.Object[an].obj)end;w.Cache.Object[an]=nil;s("Utility:Remove","Object",an)end;CreateBlip=function(bq,T,br,bs,a0)developer("^2Created^0","Blip",bq)local bt=AddBlipForCoord(T)SetBlipSprite(bt,br)SetBlipScale(bt,a0 or 1.0)SetBlipColour(bt,bs)SetBlipAsShortRange(bt,true)BeginTextCommandSetBlipName('STRING')e(bq)EndTextCommandSetBlipName(bt)return bt end;CreateJobBlip=function(bq,T,aN,br,bs,a0)s("Utility:Create","Blips",math.random(10000,99999),{name=bq,coords=T,job=aN,sprite=br,colour=bs,scale=a0 or 1.0})end;SetIdOf=function(type,an,bu)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;if DoesExist(type,an)then w.Cache[type][bu]=w.Cache[type][an]w.Cache[type][an]=nil else developer("^1Error^0","Unable to set id of the "..type.." as it does not exist",an)return end;developer("^3Change^0","Setted id to "..bu.." of the id",an)s("Utility:Remove",type,an)s("Utility:Create",type,bu,w.Cache[type][bu])end;GetDistanceFrom=function(type,an)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;local ay=0.0;if w.Cache[type][an].coords~=nil then return q(g(PlayerPedId()),w.Cache[type][an].coords,true)else return false end end;GetCoordOf=function(type,an)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;if DoesExist(type,an)then return w.Cache[type][an].coords else developer("^1Error^0","Unable to get the coords of the id",an)return false end end;DoesExist=function(type,an)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;if w.Cache[type][an]~=nil then return true else return false end end;CreateCamera=function(T,bv,aj,bw)local bx=CreateCam("DEFAULT_SCRIPTED_CAMERA",true)SetCamCoord(bx,T)if bv~=nil then SetCamRot(bx,bv.x,bv.y,bv.z)end;if bw~=nil then ShakeCam(bx,bw.type or"",bw.amount or 0.0)end;if aj then SetCamActive(bx,true)RenderScriptCams(1,1,1500)end;return bx end;SwitchBetweenCam=function(by,bx,ad)SetCamActiveWithInterp(bx,by,ad or 1500,1,1)Citizen.Wait(ad or 1500)DestroyCam(by)end;DevMode=function(bz,bA,bB)DevModeStatus=true;if bA==nil then bA=true end;bB=bB or"%s %s %s"if bz then developer=function(bC,type,an)local a7,a7,a7,bD,bE,bF=GetLocalTime()if bA then if type==nil then print(bD..":"..bE..":"..bF.." - "..bC)else print(bD..":"..bE..":"..bF.." - "..string.format(bB,bC,type,an or""))end else if type==nil then print(bC)else print(string.format(bB,bC,type,an or""))end end end else developer=function()end end end;ReplaceTexture=function(a_,bG,bH,bI,bJ)local bK=a_..":"..bG..":"local bL=bK..":"..bH;if not w.Cache.Textures[bL]then local bM=CreateRuntimeTxd(bK..'duiTxd')local bN=CreateDui(bH,bI,bJ)local bO=GetDuiHandle(bN)CreateRuntimeTextureFromDuiHandle(bM,bK..'duiTex',bO)w.Cache.Textures[bL]=true end;AddReplaceTexture(a_,bG,bK.."duiTxd",bK.."duiTex")end;printd=function(bP,bQ)if bQ then local bR={}local function bS(bT,bU)if bR[tostring(bT)]then print(bU.."*"..tostring(bT))else bR[tostring(bT)]=true;if type(bT)=="table"then for ba,bV in pairs(bT)do if type(bV)=="table"then print(bU.."["..ba.."] => "..tostring(bT).." {")bS(bV,bU..string.rep(" ",string.len(ba)+8))print(bU..string.rep(" ",string.len(ba)+6).."}")elseif type(bV)=="string"then print(bU.."["..ba.."] => \""..bV.."\"")else print(bU.."["..ba.."] => "..tostring(bV))end end else print(bU..tostring(bT))end end end;if type(bP)=="table"then print(tostring(bP).." {")bS(bP,"  ")print("}")else developer("^1Error^0","error dumping table "..bP.." why isnt a table")end else if type(bP)=="table"then print(json.encode(bP,{indent=true}))else developer("^1Error^0","error dumping table "..bP.." why isnt a table")end end end;local bW=string.gsub;string.multigsub=function(string,table,bX)if type(table)then for ax=1,#table do string=bW(string,table[ax],bX[ax])end else for ax=1,#table do string=bW(string,table[ax],bX)end end;return string end;table.fexist=function(bP,bY)bP=bP[bY]if not bP then return false else return true end end;local bZ=table.remove;table.remove=function(bP,b_,c0)if type(b_)=="number"then return bZ(bP,b_)elseif type(b_)=="string"then for b8,aG in pairs(bP)do if b8==b_ then bP[b8]=nil;if c0 then return b8 end end end end end;table.empty=function(bP)return next(bP)==nil end;table.clone=function(bP)bP.metatable={__index=bP}local c1={}setmetatable(c1,bP.metatable)return c1 end;local function c2(ai,c3,c4)return{Question=function(...)c3.questions={...}return c2(ai,c3,c4)end,Response=function(...)local c5={...}local c6={}local c7={}for c8,c9 in pairs(c5)do c7[c8]={}for b8,aG in pairs(c9)do if c6[c8]==nil then c6[c8]=""end;c6[c8]=c6[c8]..b8 .."~w~ "..aG.." | "b8=string.multigsub(b8,{"%[","%]"},{"",""})b8=string.multigsub(b8,{"~r~","~b~","~g~","~y~","~p~","~o~","~c~","~m~","~u~","~n~","~s~","~w~"},{"","","","","","","","","","","",""})c7[c8][b8]=aG end;c6[c8]=c6[c8]:sub(1,-3)end;c3.response={no_formatted=c7,formatted=c6}if c4 then s("Utility:Remove","Dialogue",ai)s("Utility:Create","Dialogue",ai,c3)else s("Utility:Create","Dialogue",ai,c3)end;w.Cache.Dialogue[ai]=c3;return c2(ai,c3,c4)end,LastQuestion=function(ca)w.Cache.Dialogue[ai].lastQuestion=ca;s("Utility:Edit","Dialogue",ai,"lastQuestion",ca)return c2(ai,c3,c4)end}end;StartDialogue=function(ai,ay,cb,cc)local c3={entity=ai,distance=ay,curQuestion=1,callback=cb,stopWhenTalking=cc,slice=tostring(GetEntitySlice(ai))}developer("^2Created^0","dialogue with entity",ai)return c2(ai,c3)end;EditDialogue=function(ai)if ai~=nil and IsEntityOnDialogue(ai)then return c2(ai,w.Cache.Dialogue[ai],true)end end;StopDialogue=function(ai,cd)if ai~=nil and IsEntityOnDialogue(ai)then developer("^1Stopping^0","dialogue",ai)if cd then w.Cache.Dialogue[ai]=nil else local ce=w.Cache.Dialogue[ai].questions[1]s("Utility:Edit","Dialogue",ai,"curQuestion",#ce)end end end;IsEntityOnDialogue=function(ai)return w.Cache.Dialogue[ai]end;RegisterNetEvent("Utility:DeleteDialogue",function(ai)w.Cache.Dialogue[ai]=nil end)function GetScaleformsStatus()local cf={}local cg={}for ax=1,10 do local ch="utility_lib_"..ax;if IsScaleformTaken(ch)then table.insert(cf,{name=ch,data=w.Cache.N3d[ch]})else table.insert(cg,{name=ch,data={txd=false,show=false,rotation={}}})end end;return cf,cg end;function IsScaleformTaken(ch)return w.Cache.N3d[ch]~=nil end;local ci=RequestScaleformMovie;local function RequestScaleformMovie(cj)local ck,cl=pcall(ci,cj)while not ck do ck,cl=pcall(ci,cj)Citizen.Wait(1)end;return cl end;local function cm(cn,ch)local co=RequestScaleformMovie(ch)local cp=GetGameTimer()while not HasScaleformMovieLoaded(co)and GetGameTimer()-cp<4000 do Citizen.Wait(0)end;if GetGameTimer()-cp>4000 then developer("^1Error^0","After 4000 ms to load the scaleform the scaleform has not loaded yet, try again or check that it has started correctly!")return end;w.Cache.N3d[cn].scaleform=co;s("Utility:Edit","N3d",cn,"scaleform",co)end;local function cq(cn,bH,bI,bJ)local bM=CreateRuntimeTxd('txd'..cn)w.Cache.N3d[cn].dui=CreateDui(bH,bI,bJ)s("Utility:Edit","N3d",cn,"dui",w.Cache.N3d[cn].dui)while not IsDuiAvailable(w.Cache.N3d[cn].dui)do Citizen.Wait(1)end;local bO=GetDuiHandle(w.Cache.N3d[cn].dui)CreateRuntimeTextureFromDuiHandle(bM,'txn'..cn,bO)if w.Cache.N3d[cn].scaleform~=nil and not w.Cache.N3d[cn].txd then BeginScaleformMovieMethod(w.Cache.N3d[cn].scaleform,'SET_TEXTURE')ScaleformMovieMethodAddParamTextureNameString('txd'..cn)ScaleformMovieMethodAddParamTextureNameString('txn'..cn)ScaleformMovieMethodAddParamInt(0)ScaleformMovieMethodAddParamInt(0)ScaleformMovieMethodAddParamInt(bI)ScaleformMovieMethodAddParamInt(bJ)EndScaleformMovieMethod()w.Cache.N3d[cn].txd=true;s("Utility:Edit","N3d",cn,"txd",true)end end;function CreateNui3d(ch,bH)local cn=tostring(math.random(0,9999))local cr={txd=false,show=false,rotation={}}w.Cache.N3d[cn]=cr;s("Utility:Create","N3d",cn,cr)cm(cn,ch)if bH~=nil then developer("^2Starting^0",cn.." with url ".."nui://"..GetCurrentResourceName().."/"..bH.." sf "..ch)cq(cn,"nui://"..GetCurrentResourceName().."/"..bH,1920,1080)end;local cs={}cs.__index=cs;cs.init=function(self,bH,bI,bJ)cq(cn,"nui://"..GetCurrentResourceName().."/"..bH,bI or 1920,bJ or 1080)end;cs.datas=function(self)return w.Cache.N3d[cn]end;cs.scale=function(self,a0)w.Cache.N3d[cn].advanced_scale=a0;s("Utility:Edit","N3d",cn,"advanced_scale",a0)end;cs.rotation=function(self,bv,ct)w.Cache.N3d[cn].rotation.rotation=bv;w.Cache.N3d[cn].rotation.syncedwithplayer=ct;s("Utility:Edit","N3d",cn,"rotation",{rotation=bv,syncedwithplayer=ct})end;cs.destroy=function(self)if w.Cache.N3d[cn].dui~=nil then DestroyDui(w.Cache.N3d[cn].dui)SetScaleformMovieAsNoLongerNeeded(w.Cache.N3d[cn].scaleform)w.Cache.N3d[cn]=nil;s("Utility:Remove","N3d",cn)end end;cs.started=function()return w.Cache.N3d[cn].dui~=nil end;cs.show=function(self,T,a0)w.Cache.N3d[cn].coords=T;w.Cache.N3d[cn].scale=a0 or 0.1;w.Cache.N3d[cn].show=true;s("Utility:Edit","N3d",cn,"coords",T)s("Utility:Edit","N3d",cn,"scale",a0 or 0.1)s("Utility:Edit","N3d",cn,"show",true)end;cs.visible=function()return w.Cache.N3d[cn].show end;cs.hide=function()w.Cache.N3d[cn].show=false;s("Utility:Edit","N3d",cn,"show",false)end;cs.attach=function(self,ai,cu)w.Cache.N3d[cn].attach={entity=ai,offset=cu or vector3(0.0,0.0,0.0)}s("Utility:Edit","N3d",cn,"attach",{entity=ai,offset=cu or vector3(0.0,0.0,0.0)})end;cs.detach=function(self,cv)if cv then w.Cache.N3d[cn].coords=GetEntityCoords(w.Cache.N3d[cn].attach.entity)s("Utility:Edit","N3d",cn,"coords",w.Cache.N3d[cn].coords)end;w.Cache.N3d[cn].attach=nil;s("Utility:Edit","N3d",cn,"attach",nil)end;cs.object=function()return w.Cache.N3d[cn].dui end;cs.msg=function(self,Q)if self:started()then SendDuiMessage(self:object(),json.encode(Q))end end;cs.replaceTexture=function(self,aa,bG,cw)if cw then Citizen.Wait(cw)end;AddReplaceTexture(aa,bG,'txd'..cn,'txn'..cn)end;return setmetatable({},cs),cn end;AddEventHandler("onResourceStop",function(cx)if cx==u then for ax=1,#w.Cache.Events do RemoveEventHandler(w.Cache.Events[ax])end;for cy,cz in pairs(w.Cache.N3d)do if cz.dui~=nil and IsDuiAvailable(cz.dui)then DestroyDui(cz.dui)end;s("Utility:Remove","N3d",cy)end;if w.Cache.Settings.UseDelete then for ax=1,#w.Cache.EntityStack do local cA=w.Cache.EntityStack[ax]NetworkRequestControlOfEntity(cA)if DoesEntityExist(cA)then DeleteEntity(cA)end end end end end)local cB=10;local cC=0.01;local cD=0.0000001;local cE=10;local cF=11;local cG=1.0/(cF-1.0)local function cH(cI,cJ)return 1.0-3.0*cJ+3.0*cI end;local function cK(cI,cJ)return 3.0*cJ-6.0*cI end;local function cL(cI)return 3.0*cI end;local function cM(cN,cI,cJ)return((cH(cI,cJ)*cN+cK(cI,cJ))*cN+cL(cI))*cN end;local function cO(cN,cI,cJ)return 3.0*cH(cI,cJ)*cN*cN+2.0*cK(cI,cJ)*cN+cL(cI)end;local function cP(cQ,cR,cS,cT,cU)local cV,cW,ax=0,0,0;repeat cW=cR+(cS-cR)/2.0;cV=cM(cW,cT,cU)-cQ;if cV>0.0 then cS=cW else cR=cW end;ax=ax+1 until math.abs(cV)<=cD or ax>=cE;return cW end;local function cX(cQ,cY,cT,cU)for ax=1,cB do local cZ=cO(cY,cT,cU)if cZ==0.0 then return cY end;local cV=cM(cY,cT,cU)-cQ;cY=cY-cV/cZ end;return cY end;local function c_(b3)return b3 end;local function d0(cT,d1,cU,d2)if not(0<=cT and cT<=1 and 0<=cU and cU<=1)then error('bezier x values must be in [0, 1] range')end;if cT==d1 and cU==d2 then return c_ end;local d3={}for ax=1,cF do d3[ax]=cM((ax-1)*cG,cT,cU)end;local function d4(cQ)local d5=0.0;local d6=1;local d7=cF-1;while d6~=d7 and d3[d6]<=cQ do d5=d5+cG;d6=d6+1 end;d6=d6-1;local d8=(cQ-d3[d6])/(d3[d6+1]-d3[d6])local d9=d5+d8*cG;local da=cO(d9,cT,cU)if da>=cC then return cX(cQ,d9,cT,cU)elseif da==0.0 then return d9 else return cP(cQ,d5,d5+cG,cT,cU)end end;return function(b3)if b3==0 or b3==1 then return b3 end;return cM(d4(b3),d1,d2)end end;local db={ease={0.25,0.1,0.25,1},easeIn={0.42,0,1,1},easeOut={0,0,0.58,1},easeInOut={0.42,0,0.58,1}}TranslateObjectCoordsCubicBezier=function(ag,C,ad,dc)local dd=GetEntityCoords(ag)local cp=GetNetworkTimeAccurate()local S=GetNetworkTimeAccurate()local de=false;local df=C-dd;local dg={"x","y","z"}if type(dc)=="string"then dc=db[dc]if not dc then error("TranslateObjectCoordsCubicBezier: `"..dc.."` its not a predefined cubic bezier")return end end;local dh=d0(table.unpack(dc))while not de and S-cp<ad do Citizen.Wait(0)local di=GetNetworkTimeAccurate()if S~=0 and di-S~=0 then local D={}local dj=(S-cp)/ad;for b8,aG in pairs(dg)do if dd[aG]==C[aG]then D[aG]=0 else local dk=math.lerp(dd[aG],C[aG],dh(dj))local dl=GetEntityCoords(ag)local ay=dl[aG]-dk;local dm=math.abs(ay)D[aG]=dm end end;de=SlideObject(ag,C,D.x,D.y,D.z,false)end;S=di end;SetEntityCoords(ag,C)end;TranslateObjectCoords=function(ag,C,ad)local dd=GetEntityCoords(ag)local cp=GetNetworkTimeAccurate()local S=GetNetworkTimeAccurate()local de=false;local df=C-dd;local dg={"x","y","z"}while not de and S-cp<ad do Citizen.Wait(0)local di=GetNetworkTimeAccurate()if S~=0 and di-S~=0 then local dn=di-S;local bA=dn/ad;local D={}for b8,aG in pairs(dg)do if df[aG]==0 then D[aG]=0 else D[aG]=math.abs(df[aG])*bA end end;de=SlideObject(ag,C,D.x,D.y,D.z,false)end;S=di end;SetEntityCoords(ag,C)end;TranslateUniformRectilinearMotion=TranslateObjectCoords;TranslateObjectRotation=function(ag,C,ad,dp)local dq=GetEntityRotation(ag,dp or 2)local cp=GetNetworkTimeAccurate()local S=GetNetworkTimeAccurate()local df=C-dq;local dg={"x","y","z"}while S-cp<ad do Citizen.Wait(0)local di=GetNetworkTimeAccurate()local dj=(S-cp)/ad;if S~=0 and di-S~=0 then local bm={}for b8,aG in pairs(dg)do bm[aG]=math.lerp(dq[aG],C[aG],dj)end;SetEntityRotation(ag,vec3(bm.x,bm.y,bm.z),2)end;S=di end;SetEntityRotation(ag,C,dp or 2)end;TranslateObjectRotationCubicBezier=function(ag,C,ad,dp,dc)local dr=GetEntityRotation(ag)local cp=GetNetworkTimeAccurate()local S=GetNetworkTimeAccurate()local de=false;local df=C-dr;df={tonumber(string.format("%.3f",df.x)),tonumber(string.format("%.3f",df.y)),tonumber(string.format("%.3f",df.z))}local dg={"x","y","z"}if type(dc)=="string"then dc=db[dc]if not dc then error("TranslateObjectCoordsCubicBezier: `"..dc.."` its not a predefined cubic bezier")return end end;local dh=d0(table.unpack(dc))while not de and S-cp<ad do Citizen.Wait(0)local di=GetNetworkTimeAccurate()if S~=0 and di-S~=0 then local bm={}local dj=(S-cp)/ad;for b8,aG in pairs(dg)do if df[aG]==0 then bm[aG]=0 else local ds=math.lerp(dr[aG],C[aG],dh(dj))bm[aG]=ds end end;SetEntityRotation(ag,bm.x,bm.y,bm.z,dp or 2)end;S=di end;SetEntityRotation(ag,C,dp or 2)end;CreateScene=function(T,bm,dt,du,dv,dw)local dx=NetworkCreateSynchronisedScene(T,bm,2,dt or false,du or false,1065353216,dw or 0,dv or 1.3)w.Cache.Scenes[dx]={coords=T,rotation=bm,players={},entities={},dicts={}}return dx end;AddEntityToScene=function(ai,dx,aa,bq,D,dy,dz)if not DoesEntityExist(tonumber(ai))then local ae=ai;local T=GetEntityCoords(PlayerPedId())ai=CreateObject(ai,T+vector3(0,0,-4.0),true)SetEntityCollision(ai,false,true)w.Cache.Scenes[dx].entities[ae]=ai end;RequestAnimDict(aa)while not HasAnimDictLoaded(aa)do Citizen.Wait(1)end;developer("^3Scenes^0","Adding object",ai,"to scene",dx,"[",aa,bq,"]")NetworkAddEntityToSynchronisedScene(ai,dx,aa,bq,D or 4.0,dy or-8.0,dz or 1)table.insert(w.Cache.Scenes[dx].dicts,aa)end;AddPlayerToScene=function(bc,dx,aa,bq,...)Citizen.InvokeNative(0x144da052257ae7d8,true)local ped=DoesEntityExist(bc)and bc or GetPlayerPed(bc)AddPedToScene(ped,dx,aa,bq,...)w.Cache.Scenes[dx].players[ped]={dict=aa,name=bq}end;AddPedToScene=function(ped,dx,aa,bq,dA,dB,ad,dz)if not DoesEntityExist(ped)then local ae=ped;ped=CreatePed(ped,vector3(0,0,0),0.0,true)w.Cache.Scenes[dx].entities[ae]=ped end;RequestAnimDict(aa)while not HasAnimDictLoaded(aa)do Citizen.Wait(1)end;developer("^3Scenes^0","Adding ped",ped,"to scene",dx,"[",aa,bq,"]")NetworkAddPedToSynchronisedScene(ped,dx,aa,bq,dA or 1.5,dB or-4.0,ad or 1,dz or 16,0,0)table.insert(w.Cache.Scenes[dx].dicts,aa)end;GoNearInitialOffset=function(bc,T,bm,aa,bq)local ped=DoesEntityExist(bc)and bc or GetPlayerPed(bc)local Z=bm and bm.z or GetEntityHeading(ped)RequestAnimDict(aa)while not HasAnimDictLoaded(aa)do Citizen.Wait(1)end;local ba=GetAnimInitialOffsetPosition(aa,bq,T,0.0,0.0,Z,0.0,2)local bm=GetAnimInitialOffsetRotation(aa,bq,T,0.0,0.0,Z,0.0,2)RemoveAnimDict(aa)TaskGoStraightToCoord(ped,ba,0.6,-1,bm.z,0.4)local dC=GetGameTimer()while#(GetEntityCoords(ped)-ba)>0.3 and GetGameTimer()-dC<4000 do Citizen.Wait(1)end;while GetEntitySpeed(ped)>0.2 and GetGameTimer()-dC<4000 do Citizen.Wait(50)end;if GetGameTimer()-dC>=4000 then TaskPedSlideToCoord(ped,ba,Z,2000)Citizen.Wait(2000)end end;StartScene=function(dx,dD)local dE=w.Cache.Scenes[dx]if dD then for ped,aG in pairs(dE.players)do GoNearInitialOffset(ped,dE.coords,dE.rotation,aG.dict,aG.name)end end;NetworkStartSynchronisedScene(dx)end;StopScene=function(dx)developer("^3Scenes^0","Stop scene",dx)NetworkStopSynchronisedScene(dx)local dE=w.Cache.Scenes[dx]for ae,ai in pairs(dE.entities)do developer("^3Scenes^0","Deleting entity",ai)DeleteEntity(ai)end;for ax=1,#dE.dicts do RemoveAnimDict(dE.dicts[ax])end end;GetSceneEntity=function(dx,ae)if ae then return w.Cache.Scenes[dx].entities[ae]else return w.Cache.Scenes[dx].entities end end;local dF=function(dG,T)local ped=PlayerPedId()local bm=GetEntityRotation(dG)local dx=CreateScene(T,bm)AddPlayerToScene(ped,dx,"anim@heists@ornate_bank@thermal_charge","thermal_charge")AddEntityToScene("hei_p_m_bag_var22_arm_s",dx,"anim@heists@ornate_bank@thermal_charge","bag_thermal_charge")StartScene(dx,true)return dx end;local dH=function(dG)local dI=GetEntitySize(dG)if doorHash==GetHashKey("hei_v_ilev_bk_safegate_pris")then return GetOffsetFromEntityInWorldCoords(dG,-(dI.x-0.1),-0.05,0.0)else return GetOffsetFromEntityInWorldCoords(dG,dI.x-0.1,-0.05,0.0)end end;local dJ=function(ped,T)local dK=CreateObject("hei_prop_heist_thermite",T-vector3(0,0,5),true)SetEntityCollision(dK,false,false)AttachEntityToEntity(dK,ped,GetPedBoneIndex(ped,28422),0,0,0,0,0,200.0,true,true,false,true,1,true)return dK end;local dL=function(dK)DetachEntity(dK,true,true)end;local dM=function(dK)return StartParticleFxOnNetworkEntity("scr_ornate_heist","scr_heist_ornate_thermal_burn",dK,vector3(0.0,1.0,-0.1),vector3(0.0,0.0,0.0),1.0)end;local dN=function(ped)TaskPlayAnim(ped,"anim@heists@ornate_bank@thermal_charge","cover_eyes_loop",1.5,1.0,-1,51,1,0,0,0)end;local dO=function(dG)local ae=GetEntityModel(dG)if ae==GetHashKey("hei_v_ilev_bk_gate_pris")then return"hei_v_ilev_bk_gate_molten"elseif ae==GetHashKey("hei_v_ilev_bk_gate2_pris")then return"hei_v_ilev_bk_gate2_molten"elseif ae==GetHashKey("hei_v_ilev_bk_safegate_pris")then return"hei_v_ilev_bk_safegate_molten"end end;local dP=function(dG)local dQ=dO(dG)if dQ then SetEntityModel(dG,dQ)end end;local dR=function(ped,dK)DeleteObject(dK)TaskPlayAnim(ped,"anim@heists@ornate_bank@thermal_charge","cover_eyes_exit",1.0,8.0,1000,51,1,0,0,0)Citizen.Wait(1000)ClearPedTasks(ped)end;BreakDoorWithThermalCharge=function(dG,dS,ad)local ped=PlayerPedId()local dT=dH(dG)local dx=dF(dG,dT)SetPedComponentVariation(ped,5,0,0,0)Citizen.Wait(1000)local dK=dJ(ped,dT)Citizen.Wait(3000)dL(dK)Citizen.Wait(1000)local dU=dM(dK)StopScene(dx)SetPedComponentVariation(ped,5,dS or 45,0,0)developer("^3Scenes^0","Cover eyes")dN(ped)Citizen.Wait(1000)dP(dG)developer("^3Scenes^0","Wait "..(ad or 3000))Citizen.Wait(ad or 3000)dR(ped,dK)end;local dV=function(type)if type=="cash"then return"hei_prop_hei_cash_trolly_01"elseif type=="gold"then return"ch_prop_gold_trolly_01a"elseif type=="diamond"then return"ch_prop_diamond_trolly_01a"end end;local dW=function(type)return"utility_heist:"..type.."_trolly:"..math.random(1,10000)end;CreateTrolly=function(type,T,dX,bj,dY,dZ,d_)local ag=nil;local an=dW(type)if type=="cash"then ag=CreateObject("hei_prop_hei_cash_trolly_01",T,d_)elseif type=="gold"then ag=CreateObject("ch_prop_gold_trolly_01a",T,d_)elseif type=="diamond"then ag=CreateObject("ch_prop_diamond_trolly_01a",T,d_)end;PlaceObjectOnGroundProperly(ag)CreateMarker(an,T,0.0,2.0,{notify=bj or"Press {E} to begin looting the trolly"})SetFor(an,"minSpeed",dY)SetFor(an,"maxSpeed",dZ)SetFor(an,"giveCash",dX)local P=nil;P=On("marker",function(e0)if e0==an then local type=an:match("utility_heist:(%w+)_trolly")local T=GetEntityCoords(PlayerPedId())local ae=dV(type)local e1=GetClosestObjectOfType(T,3.0,GetHashKey(ae))DeleteMarker(an)Citizen.Wait(500)ClearAllHelpMessages()if e1>0 then LootTrolly(an,type,e1)RemoveEventHandler(P)end end end)return an,ag end;local e2=function(type)if type=="cash"then return"hei_prop_hei_cash_trolly_03"else return"hei_prop_hei_cash_trolly_03"end end;local e3=function(type)if type=="cash"then return"hei_prop_heist_cash_pile"elseif type=="gold"then return"ch_prop_gold_bar_01a"elseif type=="diamond"then return"ch_prop_vault_dimaondbox_01a"end end;local e4=function(an,dX)PlaySoundFrontend(-1,"LOCAL_PLYR_CASH_COUNTER_INCREASE","DLC_HEISTS_GENERAL_FRONTEND_SOUNDS",true)dX()end;local e5=function(an,ae,dX)local ped=PlayerPedId()local T=GetEntityCoords(ped)local e6=CreateObject(ae,T,true)FreezeEntityPosition(e6,true)SetEntityInvincible(e6,true)SetEntityNoCollisionEntity(e6,ped)SetEntityVisible(e6,false,false)AttachEntityToEntity(e6,ped,GetPedBoneIndex(ped,60309),0.0,0.0,0.0,0.0,0.0,0.0,false,false,false,false,0,true)DisableCamCollisionForEntity(e6)w.Cache.LootingTrolly=true;Citizen.CreateThread(function()local e7=GetHashKey("CASH_APPEAR")local e8=GetHashKey("RELEASE_CASH_DESTROY")while w.Cache.LootingTrolly do if HasAnimEventFired(ped,e7)then SetEntityVisible(e6,true,false)end;if HasAnimEventFired(ped,e8)then if IsEntityVisible(e6)then SetEntityVisible(e6,false,false)e4(an,dX)end end;Citizen.Wait(1)end;DeleteObject(e6)end)end;local e9=function(ea,eb)local ped=PlayerPedId()local T=GetEntityCoords(eb)local bm=GetEntityRotation(eb)local dx=CreateScene(T,bm)AddPlayerToScene(ped,dx,"anim@heists@ornate_bank@grab_cash","intro")AddEntityToScene(ea,dx,"anim@heists@ornate_bank@grab_cash","bag_intro")StartScene(dx,true)return dx end;local ec=function(ed,ee,ef)local eg=NetworkGetLocalSceneFromNetworkId(ed)local D=ee;local eh=false;Citizen.CreateThread(function()while not eh do if IsControlJustPressed(0,24)then if D<=ef then D=D+0.1 end end;Citizen.Wait(0)end end)while not IsSynchronizedSceneRunning(eg)do eg=NetworkGetLocalSceneFromNetworkId(ed)Citizen.Wait(1)end;Citizen.CreateThread(function()AddTextEntry('PersistentButtonNotification',"Repeatedly press ~INPUT_SCRIPT_RDOWN~ to grab faster")BeginTextCommandDisplayHelp('PersistentButtonNotification')EndTextCommandDisplayHelp(0,true,true,-1)end)while GetSynchronizedScenePhase(eg)<0.99 do eg=NetworkGetLocalSceneFromNetworkId(ed)if D>ee then D=D-0.1 end;SetSynchronizedSceneRate(eg,D)Citizen.Wait(300)end;ClearAllHelpMessages()eh=true end;local ei=function(ea,eb)local ped=PlayerPedId()local T=GetEntityCoords(eb)local bm=GetEntityRotation(eb)local dx=CreateScene(T,bm)AddPlayerToScene(ped,dx,"anim@heists@ornate_bank@grab_cash","grab")AddEntityToScene(ea,dx,"anim@heists@ornate_bank@grab_cash","bag_grab")AddEntityToScene(eb,dx,"anim@heists@ornate_bank@grab_cash","cart_cash_dissapear")StartScene(dx)return dx end;local ej=function(ea,eb)local ped=PlayerPedId()local T=GetEntityCoords(eb)local bm=GetEntityRotation(eb)local dx=CreateScene(T,bm)AddPlayerToScene(ped,dx,"anim@heists@ornate_bank@grab_cash","exit")AddEntityToScene(ea,dx,"anim@heists@ornate_bank@grab_cash","bag_exit")StartScene(dx)return dx end;LootTrolly=function(an,type,eb)local ped=PlayerPedId()local ek=e3(type)local el=e2(type)local bh=GetFrom(an)if IsEntityPlayingAnim(eb,"anim@heists@ornate_bank@grab_cash","cart_cash_dissapear",3)then return end;while not NetworkHasControlOfEntity(eb)do Citizen.Wait(1)NetworkRequestControlOfEntity(eb)end;local em=CreateObject("hei_p_m_bag_var22_arm_s",vector3(0.0,0.0,0.0),true)SetEntityCollision(em,false,true)local en=e9(em,eb)developer("^3Scenes^0","Started Intro scene")SetPedComponentVariation(ped,5,0,0,0)Citizen.Wait(1500)developer("^3Scenes^0","Create cash prop")e5(an,ek,bh.giveCash)developer("^3Scenes^0","Starting grabbing scene")local ed=ei(em,eb)developer("^3Scenes^0","Started grab scene")ec(ed,bh.minSpeed or 1.0,bh.maxSpeed or 1.6)e4(an,bh.giveCash)SetEntityModel(eb,el)w.Cache.LootingTrolly=false;local eo=ej(em,eb)developer("^3Scenes^0","Started exit scene",eb)Citizen.Wait(1800)DeleteEntity(em)StopScene(en)StopScene(ed)StopScene(eo)developer("^3Scenes^0","Stopped all scenes",eb)SetPedComponentVariation(ped,5,45,0,0)end;local ep=false;local eq=false;Citizen.CreateThread(function()AddRelationshipGroup("GUARDS")SetPedRelationshipGroupHash(PlayerPedId(),GetHashKey("PLAYER"))end)local er=function(bc,aG)if HasEntityClearLosToEntity(aG,bc,27)and GetPedTaskCombatTarget(aG)~=bc then TaskCombatHatedTargetsAroundPed(aG,10.0,0)SetRelationshipBetweenGroups(5,GetHashKey("GUARDS"),GetHashKey("PLAYER"))SetPedToInformRespectedFriends(aG,30.0,3)SetPedAiBlipHasCone(aG,false)if not eq then eq=true;TriggerEvent("Utility:On:spotted",aG)end end end;local es=function()if not ep then ep=true;Citizen.CreateThread(function()while ep do if next(w.Cache.Guards)then local bc=PlayerPedId()local T=GetEntityCoords(bc)local et=GetPedStealthMovement(bc)local ay=et and 30.0 or 60.0;local eu=IsPedRunning(bc)for b8,aG in ipairs(w.Cache.Guards)do local ev=GetEntityCoords(aG)if IsPedDeadOrDying(aG)then SetPedCanRagdoll(aG,true)SetEntityAsNoLongerNeeded(aG)table.remove(w.Cache.Guards,b8)else if#(T-ev)<(eu and 8.0 or 5.0)then er(bc,aG)end;if#(T-ev)<ay then local ew=GetOffsetFromEntityInWorldCoords(aG,0.0,ay,0.0)if IsEntityInAngledArea(PlayerPedId(),ev,ew,50.0)then er(bc,aG)end end;if IsPedShooting(aG)or IsPedInCombat(aG)then SetPedToInformRespectedFriends(aG,30.0,3)SetPedAiBlipHasCone(aG,false)if not eq then eq=true;TriggerEvent("Utility:On:spotted",aG)end end end end else eq=false;ep=false end;Citizen.Wait(500)end end)end end;SetGuardDifficulty=function(ex,ey)local ez,eA,eB,eC,eD=0,0,0,0,0;if ey=="easy"then eA=1;eB=40;eC=0;eD=0 elseif ey=="medium"then eA=2;eB=60;eC=2;eD=1 elseif ey=="hard"then eA=3;eB=80;eC=2;eD=2;ez=50 elseif ey=="veryhard"then eA=3;eB=95;eC=2;eD=2;ez=100 end;SetPedArmour(ped,ez)SetPedAlertness(ped,eA)SetPedAccuracy(ped,eB)SetPedCombatRange(ped,eC)SetPedCombatAbility(ped,eD)end;CreateGuard=function(ae,T,Z,ey,eE)local ped,ah=CreatePed(ae,T,Z,true)SetPedAiBlip(ped,true)SetPedAiBlipForcedOn(ped,true)SetPedAiBlipHasCone(ped,true)SetPedRandomComponentVariation(ped,0)SetPedRandomProps(ped)SetPedCanRagdoll(ped,false)SetPedCombatMovement(ped,2)SetGuardDifficulty(ped,ey)SetPedCombatAttributes(ped,46,true)SetPedFleeAttributes(ped,0,false)SetPedRelationshipGroupHash(ped,GetHashKey("GUARDS"))if eE then TaskPatrol(ped,"miss_"..eE,1,0,1)end;table.insert(w.Cache.Guards,ped)es()return ped end;CreateGuardRoute=function(bq,eF,eG)OpenPatrolRoute("miss_"..bq)local eH={}for ax=1,#eF do local eI=eF[ax]if type(eI)=="vector3"then AddPatrolRouteNode(ax,"StandGuard",eI,eI,5000)else AddPatrolRouteNode(ax,eI.anim or"StandGuard",eI.destination,eI.viewat or eI.destination,eI.wait or 5000)end;if eG then eG(ax-1,ax)else if ax==#eF then AddPatrolRouteLink(ax,1)table.insert(eH,{eF[ax],eF[1]})end;if ax>1 then AddPatrolRouteLink(ax-1,ax)table.insert(eH,{eF[ax-1],eF[ax]})end end end;ClosePatrolRoute()CreatePatrolRoute()if DevModeStatus then CreateLoop(function(aq)for ax=1,#eH do DrawLine(eH[ax][1],eH[ax][2],255,0,0,255)end end)end end;SetGuardRoute=function(ex,eJ)TaskPatrol(ex,"miss_"..eJ,1,0,1)end;SetEntityModel=function(ai,ae)TriggerServerEvent("Utility:SwapModel",GetEntityCoords(ai),GetEntityModel(ai),type(ae)=="string"and GetHashKey(ae)or ae)end;StopCurrentTaskAndWatchPlayer=function(ped,ad)local X=GetEntityCoords(ped,true)local Y=GetEntityCoords(PlayerPedId(),true)local Z=GetHeadingFromVector_2d(Y.x-X.x,Y.y-X.y)TaskAchieveHeading(ped,Z,ad or 2000)end;StartParticleFxOnNetworkEntity=function(eK,bq,ag,...)TriggerServerEvent("Utility:StartParticleFxOnNetworkEntity",eK,bq,ObjToNet(ag),...)end;GetEntitySize=function(ai)local ae=GetEntityModel(ai)local ee,ef=GetModelDimensions(ae)return ef-ee end;DebugCoords=function(T)CreateLoop(function(aq)DrawText3Ds(T,"V")end)end;GetDirectionFromVectors=function(eL,eM)return eL-eM end;RotationToDirection=function(bv)local eN={x=math.pi/180*bv.x,y=math.pi/180*bv.y,z=math.pi/180*bv.z}local bl={x=-math.sin(eN.z)*math.abs(math.cos(eN.x)),y=math.cos(eN.z)*math.abs(math.cos(eN.x)),z=math.sin(eN.x)}return vector3(bl.x,bl.y,bl.z)end;SetVehicleWheelsPowered=function(ak,aj)for ax=0,GetVehicleNumberOfWheels(ak)-1 do SetVehicleWheelIsPowered(ak,ax,aj)end end;apairs=function(bT,eO)local eP={}local ax=0;for b8 in pairs(bT)do table.insert(eP,b8)end;table.sort(eP,eO)local eQ=function()ax=ax+1;if eP[ax]==nil then return nil else return eP[ax],bT[eP[ax]]end end;return eQ end;math.lerp=function(eR,eS,eT)return eR+(eS-eR)*eT end;math.invlerp=function(eR,eS,b7)return(b7-eR)/(eS-eR)end;CreateMissionText=function(Q,ad)SetTextEntry_2("STRING")AddTextComponentString(Q)DrawSubtitleTimed(ad and math.floor(ad)or 60000*240,1)return{delete=function()ClearPrints()end}end;WaitNear=function(T)local bc=PlayerPedId()while#(GetEntityCoords(bc)-T)>10 do Citizen.Wait(100)end end;FindInTable=function(table,_)for ax=1,#table do if table[ax]==_ then return ax end end;return nil end;GetRandom=function(table)local eU=math.random(1,#table)return table[eU]end;Probability=function(eV)return math.random(1,100)<=eV end;AddPercentage=function(eV,eW)return eV+eV*eW/100 end;RemovePercentage=function(eV,eW)return eV-eV*eW/100 end;InTimeRange=function(ee,ef)local bD=nil;if utc then local a7,a7,a7,eX=GetUtcTime()bD=eX else bD=GetClockHours()end;if ef>ee then if bD>=ee and bD<=ef then return true end else if bD<=ef or bD>=ee then return false end end end;local eY={}UtilityNet.SetModelRenderDistance=function(ae,ay)TriggerServerEvent("Utility:Net:SetModelRenderDistance",ae,ay)end;UtilityNet.CreateEntity=function(ae,T,bh)local eZ=math.random(0,10000000)local A=nil;local ai=promise:new()A=RegisterNetEvent("Utility:Net:EntityCreated"..eZ,function(e_)ai:resolve(e_)RemoveEventHandler(A)end)bh=bh or{}bh.resource=GetCurrentResourceName()TriggerServerEvent("Utility:Net:CreateEntity",eZ,ae,T,bh)local an=Citizen.Await(ai)table.insert(eY,an)return an end;UtilityNet.DeleteEntity=function(e_)TriggerServerEvent("Utility:Net:DeleteEntity",e_)for b8,aG in pairs(eY)do if aG==e_ then table.remove(eY,b8)break end end end;UtilityNet.PreserveEntity=function(e_)local ai=UtilityNet.GetEntityFromUNetId(e_)Entity(ai).state.preserved=true end;UtilityNet.OnRender=function(f0)AddEventHandler("Utility:Net:OnRender",f0)end;UtilityNet.OnUnrender=function(f0)AddEventHandler("Utility:Net:OnUnrender",f0)end;UtilityNet.AddStateBagChangeHandler=function(e_,f1)return AddStateBagChangeHandler(nil,"global",function(f2,K,b7)local f3,f4=K:match("EntityState_(%d+)_(%w+)")if tonumber(f3)==e_ and f4 then f1(f4,b7)end end)end;UtilityNet.State=function(e_)local bz=setmetatable({},{__index=function(a7,b8)local f5="EntityState_"..e_.."_"..b8;return GlobalState[f5]end,__newindex=function(a7,b8,aG)error("Cannot set states from client")end})return bz end;UtilityNet.GetEntityFromUNetId=function(e_)return exports["utility_lib"]:GetEntityFromUNetId()end;UtilityNet.GetUNetIdFromEntity=function(ai)return exports["utility_lib"]:GetUNetIdFromEntity()end;AddEventHandler("onResourceStop",function(f6)local f7=GetCurrentResourceName()if f6==f7 then for b8,aG in pairs(eY)do TriggerServerEvent("Utility:Net:DeleteEntity",aG)end end end)